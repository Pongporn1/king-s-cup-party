import { useState, useRef, useEffect } from "react";
import ReactDOM from "react-dom";
import { motion, AnimatePresence } from "framer-motion";
import { Button } from "@/components/ui/button";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Input } from "@/components/ui/input";
import { X, Send, Bot, Sparkles } from "lucide-react";

interface GameRulesAssistantProps {
  onClose: () => void;
  currentGame?: {
    id: string;
    name: string;
    emoji: string;
  };
}

interface Message {
  id: string;
  type: "user" | "ai";
  content: string;
  timestamp: Date;
}

const gameRules: Record<
  string,
  { rules: string; tips: string; examples: string }
> = {
  doraemon: {
    rules: `**King's Cup - ‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤**

**‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏Å‡∏°:**
- ‡πÉ‡∏ä‡πâ‡πÑ‡∏û‡πà‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≥‡∏£‡∏±‡∏ö 52 ‡πÉ‡∏ö
- ‡∏ß‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡∏ß‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á (King's Cup)
- ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ô‡∏±‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏á‡∏Å‡∏•‡∏°

**‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô:**
1. ‡πÄ‡∏•‡πà‡∏ô‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏Ç‡πá‡∏°‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤
2. ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô‡∏à‡∏±‡πà‡∏ß‡πÑ‡∏û‡πà 1 ‡πÉ‡∏ö
3. ‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡πÑ‡∏û‡πà‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÉ‡∏ö
4. ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡πà‡∏ß‡πÑ‡∏û‡πà K ‡πÉ‡∏ö‡∏ó‡∏µ‡πà 4 ‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏° King's Cup!

**‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡πÑ‡∏û‡πà‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÉ‡∏ö:**
- **A (Waterfall):** ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏î‡∏∑‡πà‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô ‡∏´‡πâ‡∏≤‡∏°‡∏´‡∏¢‡∏∏‡∏î‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡∏à‡∏∞‡∏´‡∏¢‡∏∏‡∏î
- **2 (You):** ‡∏ä‡∏µ‡πâ‡∏Ñ‡∏ô‡∏î‡∏∑‡πà‡∏°
- **3 (Me):** ‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°
- **4 (Floor):** ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÅ‡∏ï‡∏∞‡∏û‡∏∑‡πâ‡∏ô ‡∏Ñ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡∏∑‡πà‡∏°
- **5 (Guys):** ‡∏ú‡∏π‡πâ‡∏ä‡∏≤‡∏¢‡∏î‡∏∑‡πà‡∏°
- **6 (Chicks):** ‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡∏î‡∏∑‡πà‡∏°
- **7 (Heaven):** ‡∏ä‡∏µ‡πâ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ü‡πâ‡∏≤ ‡∏Ñ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡∏∑‡πà‡∏°
- **8 (Mate):** ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏î‡∏∑‡πà‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
- **9 (Rhyme):** ‡∏û‡∏π‡∏î‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏Å‡∏±‡∏ô ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏π‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏î‡∏∑‡πà‡∏°
- **10 (Categories):** ‡∏ö‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà ‡πÄ‡∏ä‡πà‡∏ô "‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠‡∏£‡∏ñ" ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏π‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏î‡∏∑‡πà‡∏°
- **J (Make a Rule):** ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡πÉ‡∏´‡∏°‡πà
- **Q (Question Master):** ‡πÉ‡∏Ñ‡∏£‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°
- **K (King's Cup):** ‡πÄ‡∏ó‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°‡∏•‡∏á‡πÅ‡∏Å‡πâ‡∏ß‡∏Å‡∏•‡∏≤‡∏á ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡πà‡∏ß K ‡πÉ‡∏ö‡∏ó‡∏µ‡πà 4 ‡∏î‡∏∑‡πà‡∏°‡∏´‡∏°‡∏î!`,
    tips: `**‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡πÄ‡∏•‡πà‡∏ô:**
- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤ J ‡∏ó‡∏µ‡πà‡∏™‡∏ô‡∏∏‡∏Å‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
- ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏™‡∏ï‡∏¥ ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏Ñ‡∏£‡∏î‡∏∑‡πà‡∏°
- ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏≠‡∏•‡∏Å‡∏≠‡∏Æ‡∏≠‡∏•‡πå‡∏î‡πâ‡∏ß‡∏¢
- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞ ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡πà‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡πÉ‡∏´‡πâ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô`,
    examples: `**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô:**
- ‡∏à‡∏±‡πà‡∏ß‡πÑ‡∏î‡πâ 9‚ô•: "‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™ ‡∏≠‡∏≤" ‚Üí "‡∏≠‡∏≤‡∏Å‡∏≤‡∏®" ‚Üí "‡∏≠‡∏≤‡∏´‡∏≤‡∏£" ‚Üí "‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå"
- ‡∏à‡∏±‡πà‡∏ß‡πÑ‡∏î‡πâ 10‚ô†: "‡∏´‡∏°‡∏ß‡∏î: ‡∏ú‡∏•‡πÑ‡∏°‡πâ" ‚Üí "‡∏Å‡∏•‡πâ‡∏ß‡∏¢" ‚Üí "‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á" ‚Üí "‡πÅ‡∏ï‡∏á‡πÇ‡∏°"
- ‡∏à‡∏±‡πà‡∏ß‡πÑ‡∏î‡πâ J‚ô¶: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤ "‡∏´‡πâ‡∏≤‡∏°‡∏ä‡∏µ‡πâ‡∏ô‡∏¥‡πâ‡∏ß ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏®‡∏≠‡∏Å" ‚Üí ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡∏µ‡πâ‡∏ô‡∏¥‡πâ‡∏ß‡∏î‡∏∑‡πà‡∏°`,
  },
  pokdeng: {
    rules: `**‡∏õ‡πä‡∏≠‡∏Å‡πÄ‡∏î‡πâ‡∏á - ‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤**

**‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå:** ‡∏ä‡∏ô‡∏∞‡πÄ‡∏à‡πâ‡∏≤‡∏°‡∏∑‡∏≠‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏ï‡πâ‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡πä‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤

**‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö‡πÅ‡∏ï‡πâ‡∏°:**
- A = 1 ‡πÅ‡∏ï‡πâ‡∏°
- 2-9 = ‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏û‡πà
- 10, J, Q, K = 0 ‡πÅ‡∏ï‡πâ‡∏°
- **‡πÅ‡∏ï‡πâ‡∏°‡∏£‡∏ß‡∏° = ‡πÄ‡∏≠‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢** (‡πÄ‡∏ä‡πà‡∏ô 15 = 5 ‡πÅ‡∏ï‡πâ‡∏°, 20 = 0 ‡πÅ‡∏ï‡πâ‡∏°)

**‡∏õ‡πä‡∏≠‡∏Å (Pok):**
- 2 ‡πÉ‡∏ö‡πÅ‡∏£‡∏Å‡∏£‡∏ß‡∏° 8-9 ‡πÅ‡∏ï‡πâ‡∏° = **‡∏õ‡πä‡∏≠‡∏Å** (‡∏ä‡∏ô‡∏∞‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)
- ‡∏õ‡πä‡∏≠‡∏Å 9 > ‡∏õ‡πä‡∏≠‡∏Å 8

**‡πÄ‡∏î‡πâ‡∏á (Deng - ‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì):**
1. **‡∏õ‡πä‡∏≠‡∏Å:** x2 (‡∏õ‡πä‡∏≠‡∏Å 8) ‡∏´‡∏£‡∏∑‡∏≠ x3 (‡∏õ‡πä‡∏≠‡∏Å 9)
2. **‡∏ï‡∏≠‡∏á (3 ‡πÉ‡∏ö‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô):** x3
3. **‡πÄ‡∏£‡∏µ‡∏¢‡∏á (3 ‡πÉ‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ô):** x3
4. **‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠ (3 ‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô JQK):** x5
5. **‡πÑ‡∏û‡πà‡∏Ñ‡∏π‡πà:** x2
6. **‡πÑ‡∏û‡πà‡∏î‡∏≠‡∏Å‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô 3 ‡πÉ‡∏ö:** x2

**‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô:**
1. ‡πÄ‡∏à‡πâ‡∏≤‡∏°‡∏∑‡∏≠‡πÅ‡∏à‡∏Å‡πÑ‡∏û‡πà‡∏Ñ‡∏ô‡∏•‡∏∞ 2 ‡πÉ‡∏ö
2. ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏î‡∏π‡πÑ‡∏û‡πà ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏à‡∏±‡πà‡∏ß (Draw) ‡∏´‡∏£‡∏∑‡∏≠ ‡∏≠‡∏¢‡∏π‡πà (Stand)
3. ‡πÄ‡∏à‡πâ‡∏≤‡∏°‡∏∑‡∏≠‡∏à‡∏±‡πà‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà
4. ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏û‡πà‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ô
5. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏≤‡∏°‡πÅ‡∏ï‡πâ‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏î‡πâ‡∏á`,
    tips: `**‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå:**
- **4-6 ‡πÅ‡∏ï‡πâ‡∏°:** ‡∏Ñ‡∏ß‡∏£‡∏à‡∏±‡πà‡∏ß‡πÄ‡∏™‡∏°‡∏≠ (‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÑ‡∏î‡πâ‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å)
- **7 ‡πÅ‡∏ï‡πâ‡∏°:** ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏à‡∏±‡πà‡∏ß ‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå
- **8-9 ‡πÅ‡∏ï‡πâ‡∏°:** ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏™‡∏°‡∏≠ (‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏π‡∏á‡πÅ‡∏•‡πâ‡∏ß)
- **0-3 ‡πÅ‡∏ï‡πâ‡∏°:** ‡∏à‡∏±‡πà‡∏ß (‡πÅ‡∏ó‡∏ö‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ó‡∏≤‡∏á‡πÄ‡∏™‡∏µ‡∏¢)
- ‡∏î‡∏π‡πÑ‡∏û‡πà‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏î‡∏à‡∏≥‡πÅ‡∏ï‡πâ‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠`,
    examples: `**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:**
**‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô:** K‚ô• + 9‚ô£ = 9 ‡πÅ‡∏ï‡πâ‡∏° (‡∏õ‡πä‡∏≠‡∏Å 9) ‚Üí ‡∏ä‡∏ô‡∏∞ x3
**‡πÄ‡∏à‡πâ‡∏≤‡∏°‡∏∑‡∏≠:** 5‚ô¶ + 3‚ô† = 8 ‡πÅ‡∏ï‡πâ‡∏°

**‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô:** 7‚ô† + 7‚ô• + 6‚ô£ = 0 ‡πÅ‡∏ï‡πâ‡∏° (‡πÑ‡∏û‡πà‡∏Ñ‡∏π‡πà) ‚Üí ‡πÑ‡∏î‡πâ x2 ‡πÅ‡∏°‡πâ‡πÅ‡∏ï‡πâ‡∏°‡∏ô‡πâ‡∏≠‡∏¢
**‡πÄ‡∏à‡πâ‡∏≤‡∏°‡∏∑‡∏≠:** 4‚ô¶ + 5‚ô† = 9 ‡πÅ‡∏ï‡πâ‡∏° ‚Üí ‡πÄ‡∏à‡πâ‡∏≤‡∏°‡∏∑‡∏≠‡∏ä‡∏ô‡∏∞

**‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô:** Q‚ô† + J‚ô¶ + K‚ô• = 0 ‡πÅ‡∏ï‡πâ‡∏° (‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠) ‚Üí ‡πÑ‡∏î‡πâ x5
**‡πÄ‡∏à‡πâ‡∏≤‡∏°‡∏∑‡∏≠:** 9‚ô£ + 9‚ô† = 8 ‡πÅ‡∏ï‡πâ‡∏° ‚Üí ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ä‡∏ô‡∏∞ x5`,
  },
  undercover: {
    rules: `**Undercover - ‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤**

**‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå:** 
- **‡∏û‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á:** ‡∏´‡∏≤ Undercover ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤
- **Undercover:** ‡∏≠‡∏≥‡∏û‡∏£‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏ö

**‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏Å‡∏°:**
- ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 4-12 ‡∏Ñ‡∏ô (‡∏¢‡∏¥‡πà‡∏á‡πÄ‡∏¢‡∏≠‡∏∞‡∏¢‡∏¥‡πà‡∏á‡∏™‡∏ô‡∏∏‡∏Å)
- ‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô:
  - **‡∏û‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á:** ‡πÑ‡∏î‡πâ‡∏Ñ‡∏≥‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô (‡πÄ‡∏ä‡πà‡∏ô "‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡∏¥‡∏•")
  - **Undercover:** ‡πÑ‡∏î‡πâ‡∏Ñ‡∏≥‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡πÜ (‡πÄ‡∏ä‡πà‡∏ô "‡πÅ‡∏û‡∏£‡πå")
  - **Mr.White (optional):** ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡∏≥ ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏î‡∏≤

**‡∏£‡∏≠‡∏ö‡πÄ‡∏Å‡∏°:**
**1. ‡∏£‡∏≠‡∏ö‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ (Describe Phase):**
- ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏™‡∏±‡πâ‡∏ô‡πÜ
- ‡∏´‡πâ‡∏≤‡∏°‡∏ö‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏£‡∏á‡πÜ
- ‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏ó‡∏µ‡πà‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ

**2. ‡∏£‡∏≠‡∏ö‡πÇ‡∏´‡∏ß‡∏ï (Voting Phase):**
- ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÇ‡∏´‡∏ß‡∏ï‡∏ó‡∏µ‡∏•‡∏∞‡∏Ñ‡∏ô
- ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏î‡∏ô‡πÇ‡∏´‡∏ß‡∏ï‡∏°‡∏≤‡∏Å‡∏™‡∏∏‡∏î ‚Üí ‡∏ï‡∏≤‡∏¢ (‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó)
- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Undercover ‚Üí ‡∏û‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ä‡∏ô‡∏∞
- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‚Üí ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πà‡∏≠

**3. ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ä‡∏ô‡∏∞:**
- **‡∏û‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ä‡∏ô‡∏∞:** ‡∏à‡∏±‡∏ö Undercover ‡πÑ‡∏î‡πâ‡∏´‡∏°‡∏î
- **Undercover ‡∏ä‡∏ô‡∏∞:** ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ñ‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ Undercover`,
    tips: `**‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå:**
**‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á:**
- ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ä‡∏±‡∏î‡∏û‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏û‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à
- ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏•‡∏∏‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á
- ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏û‡πâ‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ ‡∏≠‡∏¢‡πà‡∏≤‡∏ö‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏£‡∏á‡πÜ
- ‡∏î‡∏π‡∏õ‡∏è‡∏¥‡∏Å‡∏¥‡∏£‡∏¥‡∏¢‡∏≤‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏ï‡∏≠‡∏ô‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢

**‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Undercover:**
- ‡∏ü‡∏±‡∏á‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏π‡∏î
- ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ó‡∏±‡πà‡∏ß‡πÜ ‡πÑ‡∏õ ‡∏û‡∏≠‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ
- ‡∏õ‡∏±‡πà‡∏ô‡∏´‡∏±‡∏ß‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡πÇ‡∏î‡∏¢‡∏ä‡∏µ‡πâ‡∏Ñ‡∏ô‡∏ö‡∏£‡∏¥‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡πå
- ‡∏≠‡∏¢‡πà‡∏≤‡∏û‡∏π‡∏î‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ`,
    examples: `**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô:**
**‡∏û‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÑ‡∏î‡πâ:** "‡∏™‡∏ï‡∏£‡∏≠‡∏ß‡πå‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà"
**Undercover ‡πÑ‡∏î‡πâ:** "‡∏£‡∏≤‡∏™‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà"

**‡∏£‡∏≠‡∏ö 1 - ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:**
- A: "‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏™‡∏µ‡πÅ‡∏î‡∏á"
- B: "‡∏°‡∏µ‡πÄ‡∏°‡∏•‡πá‡∏î‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡∏≠‡∏Å"
- C: "‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏™‡∏µ‡πÅ‡∏î‡∏á ‡∏£‡∏™‡πÄ‡∏õ‡∏£‡∏µ‡πâ‡∏¢‡∏ß‡∏´‡∏ß‡∏≤‡∏ô" ‚Üê Undercover
- D: "‡∏Å‡∏¥‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏Ñ‡πâ‡∏Å‡∏≠‡∏£‡πà‡∏≠‡∏¢"

**‡∏£‡∏≠‡∏ö 2 - ‡πÇ‡∏´‡∏ß‡∏ï:**
- A,B,D ‡∏™‡∏á‡∏™‡∏±‡∏¢ C (‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô)
- C ‡πÇ‡∏î‡∏ô‡πÇ‡∏´‡∏ß‡∏ï 3 ‡πÄ‡∏™‡∏µ‡∏¢‡∏á ‚Üí ‡∏ï‡∏≤‡∏¢
- ‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó: Undercover ‚Üí **‡∏û‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ä‡∏ô‡∏∞!**`,
  },
  paranoia: {
    rules: `**Paranoia - ‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤**

**‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå:** ‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏•‡∏±‡∏ö‡πÜ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏™‡∏á‡∏™‡∏±‡∏¢‡∏ß‡πà‡∏≤‡∏ñ‡∏≤‡∏°‡∏≠‡∏∞‡πÑ‡∏£

**‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏Å‡∏°:**
- ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 3-10 ‡∏Ñ‡∏ô
- ‡∏ô‡∏±‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏á‡∏Å‡∏•‡∏°
- ‡∏°‡∏µ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏≠‡∏û‡∏™‡∏∏‡πà‡∏° (Reveal/Hide)

**‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô:**
**1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏´‡∏¢‡∏∑‡πà‡∏≠ (Select Victim):**
- ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ñ‡∏≤‡∏°

**2. ‡∏Å‡∏£‡∏∞‡∏ã‡∏¥‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° (Whisper Question):**
- ‡∏Å‡∏£‡∏∞‡∏ã‡∏¥‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏ö‡∏≤‡πÜ ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏¢‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÑ‡∏î‡πâ‡∏¢‡∏¥‡∏ô
- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô "‡πÉ‡∏Ñ‡∏£" ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: "‡πÉ‡∏Ñ‡∏£‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏î‡∏ó‡∏î‡πâ‡∏ß‡∏¢?", "‡πÉ‡∏Ñ‡∏£‡∏î‡∏π‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î?"

**3. ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° (Answer):**
- ‡πÄ‡∏´‡∏¢‡∏∑‡πà‡∏≠‡∏ï‡∏≠‡∏ö**‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô**‡πÉ‡∏ô‡∏ß‡∏á‡∏î‡∏±‡∏á‡πÜ (‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÑ‡∏î‡πâ‡∏¢‡∏¥‡∏ô)
- ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏ñ‡∏≤‡∏°‡∏≠‡∏∞‡πÑ‡∏£ ‡πÅ‡∏ï‡πà‡∏£‡∏π‡πâ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö

**4. ‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢ (Reveal):**
- ‡πÉ‡∏ä‡πâ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç/‡πÅ‡∏≠‡∏û‡∏™‡∏∏‡πà‡∏° (50:50)
- **Reveal:** ‡πÄ‡∏´‡∏¢‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏î‡∏±‡∏á‡πÜ (‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÑ‡∏î‡πâ‡∏¢‡∏¥‡∏ô)
- **Hide:** ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö

**5. ‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô:**
- ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡∏Ñ‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‡∏ß‡∏ô‡πÑ‡∏õ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ

**‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:**
- ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≠‡∏ö‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á
- ‡∏´‡πâ‡∏≤‡∏°‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏ï‡∏≠‡∏ö ‚Üí ‡∏î‡∏∑‡πà‡∏°/‡∏£‡∏±‡∏ö‡πÇ‡∏ó‡∏©`,
    tips: `**‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö:**
**‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ñ‡∏≤‡∏°:**
- ‡∏ñ‡∏≤‡∏°‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏π‡πâ‡∏à‡∏£‡∏¥‡∏á‡πÜ
- ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏™‡∏á‡∏™‡∏±‡∏¢ (‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Å‡∏∂‡πà‡∏á‡∏•‡∏±‡∏ö)
- ‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏•‡∏∂‡∏Å‡∏•‡∏±‡∏ö‡∏û‡∏≠‡∏î‡∏µ

**‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏¢‡∏∑‡πà‡∏≠:**
- ‡∏ï‡∏≠‡∏ö‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á ‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏°‡∏™‡∏ô‡∏∏‡∏Å‡∏Å‡∏ß‡πà‡∏≤
- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏ï‡∏≠‡∏ö ‡∏Å‡πá‡∏ö‡∏≠‡∏Å‡∏ï‡∏£‡∏á‡πÜ
- ‡∏≠‡∏¢‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ß ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏à‡∏∞‡πÇ‡∏î‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô

**Tips ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®:**
- ‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏™‡∏ô‡∏¥‡∏ó ‡∏à‡∏∞‡∏™‡∏ô‡∏∏‡∏Å‡∏Å‡∏ß‡πà‡∏≤
- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÄ‡∏ä‡πà‡∏ô "‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏´‡πâ‡∏≤‡∏°‡∏ã‡πâ‡∏≥"
- ‡∏≠‡∏¢‡πà‡∏≤‡∏ñ‡∏≤‡∏°‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡πà‡∏≠‡∏ô‡∏à‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ`,
    examples: `**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô:**
**‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà 1:**
- **‡∏ú‡∏π‡πâ‡∏ñ‡∏≤‡∏° (A):** ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å B ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏´‡∏¢‡∏∑‡πà‡∏≠
- **‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° (‡∏Å‡∏£‡∏∞‡∏ã‡∏¥‡∏ö):** "‡πÉ‡∏Ñ‡∏£‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á?"
- **B ‡∏ï‡∏≠‡∏ö (‡∏î‡∏±‡∏á‡πÜ):** "C"
- **‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô:** ü§î ‡∏ñ‡∏≤‡∏°‡∏≠‡∏∞‡πÑ‡∏£‡∏ô‡∏∞?
- **‡∏™‡∏∏‡πà‡∏°:** Hide ‚Üí ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö
- **‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** C ‡∏™‡∏á‡∏™‡∏±‡∏¢‡∏ß‡πà‡∏≤ B ‡∏ï‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏ó‡∏≥‡πÑ‡∏° (‡∏ä‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏î‡πà‡∏≤?)

**‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà 2:**
- **‡∏ú‡∏π‡πâ‡∏ñ‡∏≤‡∏° (D):** ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å E ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏´‡∏¢‡∏∑‡πà‡∏≠
- **‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° (‡∏Å‡∏£‡∏∞‡∏ã‡∏¥‡∏ö):** "‡πÉ‡∏Ñ‡∏£‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏õ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏î‡πâ‡∏ß‡∏¢?"
- **E ‡∏ï‡∏≠‡∏ö (‡∏î‡∏±‡∏á‡πÜ):** "A"
- **‡∏™‡∏∏‡πà‡∏°:** Reveal ‚Üí E ‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
- **E ‡∏û‡∏π‡∏î:** "‡∏ñ‡∏≤‡∏°‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡∏ó‡∏µ‡πà‡∏â‡∏±‡∏ô‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏õ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏î‡πâ‡∏ß‡∏¢"
- **‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** A ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤ E ‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏õ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏î‡πâ‡∏ß‡∏¢`,
  },
  fivesec: {
    rules: `**5 Second Rule - ‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤**

**‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå:** ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° 3 ‡∏Ç‡πâ‡∏≠ ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ!

**‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏Å‡∏°:**
- ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 3-10 ‡∏Ñ‡∏ô
- ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
- ‡πÄ‡∏•‡πà‡∏ô‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏Ç‡πá‡∏°‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤

**‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô:**
**1. ‡∏≠‡∏≠‡∏Å‡πÇ‡∏à‡∏ó‡∏¢‡πå:**
- ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° "‡∏ï‡∏≠‡∏ö 3 ‡∏Ç‡πâ‡∏≠‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö..."
- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: "‡∏ï‡∏≠‡∏ö 3 ‡∏ú‡∏•‡πÑ‡∏°‡πâ", "‡∏ï‡∏≠‡∏ö 3 ‡∏ô‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏á", "‡∏ï‡∏≠‡∏ö 3 ‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®"

**2. ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ:**
- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á: 5... 4... 3... 2... 1...
- ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≠‡∏ö 3 ‡∏Ç‡πâ‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ

**3. ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡∏ú‡∏•:**
- **‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏£‡∏ö 3 ‡∏Ç‡πâ‡∏≠‡∏ó‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤:** ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô (‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)
- **‡∏ï‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö/‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ô:** ‚ùå ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô (‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)
- **‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î/‡∏ã‡πâ‡∏≥:** ‚ùå ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô

**4. ‡πÇ‡∏´‡∏ß‡∏ï (Optional):**
- ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÇ‡∏´‡∏ß‡∏ï‡∏ß‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
- ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Ç‡πâ‡∏≤‡∏á‡∏°‡∏≤‡∏Å‡∏ä‡∏ô‡∏∞

**5. ‡∏™‡∏∞‡∏™‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:**
- ‡πÉ‡∏Ñ‡∏£‡∏ï‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏™‡∏∏‡∏î = ‡∏ä‡∏ô‡∏∞!

**‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:**
- ‡∏´‡πâ‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏£‡∏≠‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
- ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏à‡∏ó‡∏¢‡πå
- ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡πÄ‡∏ä‡πà‡∏ô "‡∏≠‡∏±‡∏ô‡∏ô‡∏±‡πâ‡∏ô"`,
    tips: `**‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö:**
**‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô:**
- **‡∏≠‡∏¢‡πà‡∏≤‡∏Ñ‡∏¥‡∏î‡∏°‡∏≤‡∏Å** ‡∏û‡∏π‡∏î‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏∂‡∏Å‡πÑ‡∏î‡πâ
- **‡∏û‡∏π‡∏î‡πÄ‡∏£‡πá‡∏ß‡πÜ** ‡∏≠‡∏¢‡πà‡∏≤‡∏£‡∏≠‡∏Ñ‡∏¥‡∏î
- **‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏™‡∏≥‡∏£‡∏≠‡∏á** ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤
- **‡∏ù‡∏∂‡∏Å‡∏ã‡πâ‡∏≠‡∏°** ‡πÄ‡∏•‡πà‡∏ô‡∏ö‡πà‡∏≠‡∏¢‡πÜ ‡∏à‡∏∞‡∏ï‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô

**‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå:**
- **‡∏ú‡∏•‡πÑ‡∏°‡πâ:** ‡∏Å‡∏•‡πâ‡∏ß‡∏¢ ‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡∏¥‡∏• ‡∏™‡πâ‡∏° (‡∏Ñ‡∏∏‡πâ‡∏ô‡πÄ‡∏Ñ‡∏¢ = ‡∏û‡∏π‡∏î‡πÄ‡∏£‡πá‡∏ß)
- **‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®:** ‡πÑ‡∏ó‡∏¢ ‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô ‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏≤
- **‡∏™‡∏µ:** ‡πÅ‡∏î‡∏á ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
- **‡∏™‡∏±‡∏ï‡∏ß‡πå:** ‡∏´‡∏°‡∏≤ ‡πÅ‡∏°‡∏ß ‡∏ä‡πâ‡∏≤‡∏á

**‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÄ‡∏£‡πá‡∏ß:**
- ‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡πá‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á
- ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏ß‡∏á (‡∏ñ‡πâ‡∏≤‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö)
- ‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö (‡∏à‡∏≥‡∏á‡πà‡∏≤‡∏¢)`,
    examples: `**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô:**
**‡πÇ‡∏à‡∏ó‡∏¢‡πå:** "‡∏ï‡∏≠‡∏ö 3 ‡∏ú‡∏•‡πÑ‡∏°‡πâ"
- **‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô A:** "‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡∏¥‡∏• ‡∏Å‡∏•‡πâ‡∏ß‡∏¢ ‡∏™‡πâ‡∏°" ‚Üí ‚úÖ **‡∏ú‡πà‡∏≤‡∏ô**
- **‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô B:** "‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á... ‡πÄ‡∏≠‡πà‡∏≠... ‡∏°‡∏∞‡∏ô‡∏≤‡∏ß... ‡πÄ‡∏≠‡πà‡∏≠..." ‚Üí ‚ùå **‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô (‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡∏ß‡∏¥)**
- **‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô C:** "‡∏™‡∏ï‡∏£‡∏≠‡∏ß‡πå‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà ‡∏ö‡∏•‡∏π‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà ‡∏£‡∏≤‡∏™‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà" ‚Üí ‚úÖ **‡∏ú‡πà‡∏≤‡∏ô**

**‡πÇ‡∏à‡∏ó‡∏¢‡πå:** "‡∏ï‡∏≠‡∏ö 3 ‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÉ‡∏ô‡∏¢‡∏∏‡πÇ‡∏£‡∏õ"
- **‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô A:** "‡∏ù‡∏£‡∏±‡πà‡∏á‡πÄ‡∏®‡∏™ ‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© ‡πÄ‡∏¢‡∏≠‡∏£‡∏°‡∏ô‡∏µ" ‚Üí ‚úÖ **‡∏ú‡πà‡∏≤‡∏ô**
- **‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô B:** "‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏≤ ‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©..." ‚Üí ‚ùå **‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô (‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏¢‡∏∏‡πÇ‡∏£‡∏õ)**

**‡πÇ‡∏à‡∏ó‡∏¢‡πå:** "‡∏ï‡∏≠‡∏ö 3 ‡∏≠‡∏≤‡∏ä‡∏µ‡∏û"
- **‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô A:** "‡∏´‡∏°‡∏≠ ‡∏Ñ‡∏£‡∏π ‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£" ‚Üí ‚úÖ **‡∏ú‡πà‡∏≤‡∏ô**
- **‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô B:** "‡∏ï‡∏≥‡∏£‡∏ß‡∏à ‡∏ó‡∏´‡∏≤‡∏£ ‡∏ï‡∏≥‡∏£‡∏ß‡∏à" ‚Üí ‚ùå **‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô (‡∏ã‡πâ‡∏≥)**`,
  },
};

export function GameRulesAssistant({
  onClose,
  currentGame,
}: GameRulesAssistantProps) {
  const [messages, setMessages] = useState<Message[]>([]);
  const [input, setInput] = useState("");
  const [isTyping, setIsTyping] = useState(false);
  const scrollRef = useRef<HTMLDivElement>(null);
  const inputRef = useRef<HTMLInputElement>(null);

  // Auto scroll to bottom
  useEffect(() => {
    if (scrollRef.current) {
      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
    }
  }, [messages, isTyping]);

  // Initial greeting
  useEffect(() => {
    const greeting: Message = {
      id: Date.now().toString(),
      type: "ai",
      content: `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ú‡∏° AI ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ö‡∏≠‡∏Å‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡πÄ‡∏Å‡∏°${
        currentGame ? ` **${currentGame.emoji} ${currentGame.name}**` : ""
      }

‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ñ‡∏≤‡∏°‡∏ú‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô:
${currentGame ? '- "‡∏ö‡∏≠‡∏Å‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤"' : '- "‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤ King\'s Cup"'}
- "‡∏°‡∏µ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á"
- "‡∏¢‡∏Å‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô"
${!currentGame ? '- "‡πÄ‡∏Å‡∏°‡πÑ‡∏´‡∏ô‡πÄ‡∏•‡πà‡∏ô‡∏á‡πà‡∏≤‡∏¢"' : ""}

‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö`,
      timestamp: new Date(),
    };
    setMessages([greeting]);
  }, [currentGame]);

  const findBestMatch = (userInput: string): string => {
    const input = userInput.toLowerCase();

    // Check for game-specific queries
    const gameId = currentGame?.id;

    // Rules keywords
    if (input.match(/‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤|‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô|‡πÄ‡∏•‡πà‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏á|‡∏Å‡∏è|rule/i)) {
      if (gameId && gameRules[gameId]) {
        return gameRules[gameId].rules;
      }
      return "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏£‡∏≤‡∏ö‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡∏Ñ‡∏£‡∏±‡∏ö (King's Cup, Pok Deng, Undercover, Paranoia, 5 Second Rule)";
    }

    // Tips keywords
    if (input.match(/‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö|‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå|‡∏ß‡∏¥‡∏ò‡∏µ|tip|strategy|‡∏ó‡∏≥‡∏¢‡∏±‡∏á‡πÑ‡∏á/i)) {
      if (gameId && gameRules[gameId]) {
        return gameRules[gameId].tips;
      }
      return "‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏π‡πâ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡πÄ‡∏Å‡∏°‡πÑ‡∏´‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö?";
    }

    // Examples keywords
    if (input.match(/‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á|‡∏¢‡∏Å‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á|example|‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏£‡∏¥‡∏á/i)) {
      if (gameId && gameRules[gameId]) {
        return gameRules[gameId].examples;
      }
      return "‡∏≠‡∏¢‡∏≤‡∏Å‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏Å‡∏°‡πÑ‡∏´‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö?";
    }

    // Game selection keywords
    if (input.match(/king|‡∏Ñ‡∏¥‡∏á|‡πÑ‡∏û‡πà/i)) {
      return gameRules.doraemon.rules;
    }
    if (input.match(/‡∏õ‡πä‡∏≠‡∏Å|pok|deng|‡πÄ‡∏î‡πâ‡∏á/i)) {
      return gameRules.pokdeng.rules;
    }
    if (input.match(/undercover|‡∏™‡∏≤‡∏¢‡∏•‡∏±‡∏ö|‡∏õ‡∏•‡∏≠‡∏°/i)) {
      return gameRules.undercover.rules;
    }
    if (input.match(/paranoia|‡∏Ç‡∏µ‡πâ‡∏´‡∏ß‡∏≤‡∏î|‡∏Å‡∏£‡∏∞‡∏ã‡∏¥‡∏ö/i)) {
      return gameRules.paranoia.rules;
    }
    if (input.match(/5|‡∏´‡πâ‡∏≤|‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ|second/i)) {
      return gameRules.fivesec.rules;
    }

    // Easy game
    if (input.match(/‡∏á‡πà‡∏≤‡∏¢|easy|‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô|‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà/i)) {
      return `‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î:
      
1. **5 Second Rule** - ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÅ‡∏Ñ‡πà‡∏ï‡∏≠‡∏ö 3 ‡∏Ç‡πâ‡∏≠‡πÉ‡∏ô 5 ‡∏ß‡∏¥
2. **King's Cup** - ‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ù‡∏π‡∏á‡∏™‡∏ô‡∏∏‡∏Å
3. **Undercover** - ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏á‡πà‡∏≤‡∏¢ ‡πÅ‡∏ï‡πà‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏ô‡∏∏‡∏Å

‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ **5 Second Rule** ‡∏Ñ‡∏£‡∏±‡∏ö!`;
    }

    // Fun game
    if (input.match(/‡∏™‡∏ô‡∏∏‡∏Å|fun|‡πÄ‡∏û‡∏•‡∏¥‡∏ô/i)) {
      return `‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏ô‡∏∏‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î:

1. **Undercover** - ‡πÇ‡∏Å‡∏´‡∏Å ‡∏´‡∏•‡∏≠‡∏Å‡∏•‡∏ß‡∏á ‡∏™‡∏ô‡∏∏‡∏Å‡∏™‡∏∏‡∏î‡πÜ!
2. **Paranoia** - ‡∏•‡∏∏‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏ñ‡∏≤‡∏°‡∏≠‡∏∞‡πÑ‡∏£ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏π‡πâ
3. **King's Cup** - ‡∏Ñ‡∏•‡∏≤‡∏™‡∏™‡∏¥‡∏Å ‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ù‡∏π‡∏á‡∏°‡∏±‡∏ô‡∏™‡πå

‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏Å‡∏°‡∏™‡∏ô‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏•‡∏∞‡πÅ‡∏ö‡∏ö ‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö!`;
    }

    // How many players
    if (input.match(/‡∏Å‡∏µ‡πà‡∏Ñ‡∏ô|‡∏à‡∏≥‡∏ô‡∏ß‡∏ô|players|people/i)) {
      return `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏Å‡∏°:

**King's Cup:** 3-10 ‡∏Ñ‡∏ô (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ 4-8)
**Pok Deng:** 2-8 ‡∏Ñ‡∏ô (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ 3-5)
**Undercover:** 4-12 ‡∏Ñ‡∏ô (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ 6-10)
**Paranoia:** 3-10 ‡∏Ñ‡∏ô (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ 5-8)
**5 Second Rule:** 3-10 ‡∏Ñ‡∏ô (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ 4-8)

‡πÄ‡∏•‡πà‡∏ô 2 ‡∏Ñ‡∏ô ‚Üí **Pok Deng**
‡πÄ‡∏•‡πà‡∏ô 4-6 ‡∏Ñ‡∏ô ‚Üí ‡πÄ‡∏Å‡∏°‡πÑ‡∏´‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ
‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞ (8+ ‡∏Ñ‡∏ô) ‚Üí **Undercover**`;
    }

    // Default response
    return `‡∏Ç‡∏≠‡πÇ‡∏ó‡∏©‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ú‡∏°‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏≤‡∏°‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∞‡πÑ‡∏£

‡∏•‡∏≠‡∏á‡∏ñ‡∏≤‡∏°‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢:
- "‡∏ö‡∏≠‡∏Å‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤ ${currentGame?.name || "King's Cup"}"
- "‡∏°‡∏µ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á"
- "‡∏¢‡∏Å‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô"
- "‡πÄ‡∏Å‡∏°‡πÑ‡∏´‡∏ô‡πÄ‡∏•‡πà‡∏ô‡∏á‡πà‡∏≤‡∏¢"
- "‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏µ‡πà‡∏Ñ‡∏ô"

‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡∏Å‡πá‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡∏ö`;
  };

  const handleSend = () => {
    if (!input.trim()) return;

    // Add user message
    const userMessage: Message = {
      id: Date.now().toString(),
      type: "user",
      content: input.trim(),
      timestamp: new Date(),
    };
    setMessages((prev) => [...prev, userMessage]);
    setInput("");

    // Simulate AI typing
    setIsTyping(true);
    setTimeout(() => {
      const response = findBestMatch(input);
      const aiMessage: Message = {
        id: (Date.now() + 1).toString(),
        type: "ai",
        content: response,
        timestamp: new Date(),
      };
      setMessages((prev) => [...prev, aiMessage]);
      setIsTyping(false);
    }, 500 + Math.random() * 1000);
  };

  const handleKeyPress = (e: React.KeyboardEvent) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      handleSend();
    }
  };

  const quickQuestions = [
    { text: "‡∏ö‡∏≠‡∏Å‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤" },
    { text: "‡∏°‡∏µ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á" },
    { text: "‡∏¢‡∏Å‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á" },
  ];

  return ReactDOM.createPortal(
    <motion.div
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
      className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4"
      style={{ zIndex: 9999 }}
      onClick={onClose}
    >
      <motion.div
        initial={{ scale: 0.9, opacity: 0, y: 20 }}
        animate={{ scale: 1, opacity: 1, y: 0 }}
        exit={{ scale: 0.9, opacity: 0, y: 20 }}
        transition={{ type: "spring", duration: 0.5 }}
        onClick={(e) => e.stopPropagation()}
        style={{ zIndex: 10000 }}
        className="bg-gradient-to-br from-slate-900 via-purple-900/20 to-slate-900 rounded-3xl shadow-2xl w-full max-w-3xl h-[600px] flex flex-col border border-purple-500/30 overflow-hidden"
      >
        {/* Header */}
        <div className="bg-gradient-to-r from-purple-600 to-pink-600 p-4 flex items-center justify-between">
          <div className="flex items-center gap-3">
            <div className="bg-white/20 backdrop-blur-sm p-2 rounded-full">
              <Bot className="w-6 h-6 text-white" />
            </div>
            <div>
              <h2 className="text-white font-bold text-lg flex items-center gap-2">
                <Sparkles className="w-5 h-5" />
                AI ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ö‡∏≠‡∏Å‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤
              </h2>
              {currentGame && (
                <p className="text-white/80 text-sm">
                  {currentGame.emoji} {currentGame.name}
                </p>
              )}
            </div>
          </div>
          <Button
            onClick={onClose}
            variant="ghost"
            size="icon"
            className="text-white hover:bg-white/20"
          >
            <X className="w-5 h-5" />
          </Button>
        </div>

        {/* Chat Area */}
        <ScrollArea className="flex-1 p-4" ref={scrollRef}>
          <div className="space-y-4">
            {messages.map((message) => (
              <motion.div
                key={message.id}
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                className={`flex ${
                  message.type === "user" ? "justify-end" : "justify-start"
                }`}
              >
                <div
                  className={`max-w-[80%] rounded-2xl px-4 py-3 ${
                    message.type === "user"
                      ? "bg-gradient-to-r from-purple-600 to-pink-600 text-white"
                      : "bg-slate-800 text-slate-100 border border-slate-700"
                  }`}
                >
                  <div className="whitespace-pre-wrap text-sm leading-relaxed">
                    {message.content}
                  </div>
                  <div
                    className={`text-xs mt-1 ${
                      message.type === "user"
                        ? "text-white/70"
                        : "text-slate-400"
                    }`}
                  >
                    {message.timestamp.toLocaleTimeString("th-TH", {
                      hour: "2-digit",
                      minute: "2-digit",
                    })}
                  </div>
                </div>
              </motion.div>
            ))}

            {isTyping && (
              <motion.div
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                className="flex justify-start"
              >
                <div className="bg-slate-800 border border-slate-700 rounded-2xl px-4 py-3 flex items-center gap-2">
                  <div className="flex gap-1">
                    <motion.div
                      animate={{ scale: [1, 1.2, 1] }}
                      transition={{
                        repeat: Infinity,
                        duration: 1,
                        delay: 0,
                      }}
                      className="w-2 h-2 bg-purple-500 rounded-full"
                    />
                    <motion.div
                      animate={{ scale: [1, 1.2, 1] }}
                      transition={{
                        repeat: Infinity,
                        duration: 1,
                        delay: 0.2,
                      }}
                      className="w-2 h-2 bg-purple-500 rounded-full"
                    />
                    <motion.div
                      animate={{ scale: [1, 1.2, 1] }}
                      transition={{
                        repeat: Infinity,
                        duration: 1,
                        delay: 0.4,
                      }}
                      className="w-2 h-2 bg-purple-500 rounded-full"
                    />
                  </div>
                  <span className="text-slate-400 text-sm">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå...</span>
                </div>
              </motion.div>
            )}
          </div>
        </ScrollArea>

        {/* Quick Questions */}
        {messages.length <= 1 && (
          <div className="px-4 pb-2">
            <div className="flex gap-2 flex-wrap">
              {quickQuestions.map((q) => (
                <Button
                  key={q.text}
                  onClick={() => {
                    setInput(q.text);
                    setTimeout(() => {
                      inputRef.current?.focus();
                    }, 0);
                  }}
                  variant="outline"
                  size="sm"
                  className="bg-slate-800 border-slate-700 hover:bg-slate-700 text-slate-200 text-xs"
                >
                  {q.text}
                </Button>
              ))}
            </div>
          </div>
        )}

        {/* Input Area */}
        <div className="bg-slate-800/50 border-t border-slate-700 p-4">
          <div className="flex gap-2">
            <Input
              ref={inputRef}
              value={input}
              onChange={(e) => setInput(e.target.value)}
              onKeyPress={handleKeyPress}
              placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..."
              className="flex-1 bg-slate-900 border-slate-700 text-white placeholder:text-slate-500"
              disabled={isTyping}
            />
            <Button
              onClick={handleSend}
              disabled={!input.trim() || isTyping}
              className="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700"
            >
              <Send className="w-4 h-4" />
            </Button>
          </div>
        </div>
      </motion.div>
    </motion.div>,
    document.body
  );
}
